<div class="heading text-center">
    <h3>Update GATE Configuration</h3>
</div>
<i class="pull-right">
    <a [routerLink]="['/modePdf']">
        To know more about <strong>modes</strong>...
    </a>
</i>

<br>

<hr>


<form [formGroup]="editForm" (ngSubmit)="onFormSubmit()">
    <div class="form-row">
        <div class="col-md-4 form-group">
            <label>Gate Name</label>
            <input type="text" class="form-control" formControlName="gateName" [ngClass]="{
                'is-invalid': submitted
                 }" [readonly]="true">
            <div *ngIf="submitted" class="invalid-feedback">
                <div *ngIf="
                                            editForm.controls.gateName.errors &&
                                            editForm.controls.gateName.errors.required
                                        ">
                    {{
                                            editForm.controls.gateName.errors.required.message
                                        }}
                </div>
            </div>
        </div>
        <div class="col-md-4 form-group">
            <label>Mode Name</label>
            <select class="form-control" formControlName="modeName" (ngModelChange)="onChange($event)" [ngClass]="{
                                        'is-invalid': submitted
                                    }">
                <!-- <option value="">Select Mode</option> -->
                <option *ngFor="let item of mode" [ngValue]="item.modeName">
                    {{ item.modeName }}
                </option>
            </select>
            <div *ngIf="submitted" class="invalid-feedback">
                <div *ngIf="
                                            editForm.controls.modeName.errors &&
                                            editForm.controls.modeName.errors.required
                                        ">
                    {{
                                            editForm.controls.modeName.errors.required.message
                                        }}
                </div>
            </div>
        </div>

        <div class="col-md-4 form-group">
            <label>Emergency Mode</label>
            <select class="form-control" formControlName="emergencyModeName" [ngClass]="{
                                        'is-invalid': submitted
                                    }">
                <!-- <option value="">Select Emergency Mode</option> -->
                <option *ngFor="let item of emergency" [ngValue]="item.emergencyModeName">
                    {{ item.emergencyModeName }}
                </option>
            </select>
            <div *ngIf="submitted" class="invalid-feedback">
                <div *ngIf="
                                            editForm.controls.emergencyModeName.errors &&
                                            editForm.controls.emergencyModeName.errors.required
                                        ">
                    {{
                                            editForm.controls.emergencyModeName.errors.required.message
                                        }}
                </div>
            </div>
        </div>
        <div class="col-md-4 form-group">
            <label for="">Direction Name</label>
            <select class="form-control" formControlName="directionName" [ngClass]="{
                                        'is-invalid': submitted
                                    }">
                <!-- <option value="">Select Direction</option> -->
                <option *ngFor="let direction of direction" [ngValue]="direction.directionCode">
                    {{ direction.directionName }}
                </option>
            </select>
            <div *ngIf="submitted" class="invalid-feedback">
                <div *ngIf="
                                            editForm.controls.directionName.errors &&
                                            editForm.controls.directionName.errors.required
                                        ">
                    {{
                                            editForm.controls.directionName.errors.required.message
                                        }}
                </div>
            </div>
        </div>

        <div class="col-md-4 form-group">
            <label for="">Aisle Mode</label>
            <select class="form-control" formControlName="aisleModeName" [ngClass]="{
                                        'is-invalid': submitted
                                    }">
                <!-- <option value="">Select Aisle Mode</option> -->
                <option *ngFor="let item of aisleMode" [ngValue]="item.aisleModeName">
                    {{ item.aisleModeName }}
                </option>
            </select>
            <div *ngIf="submitted" class="invalid-feedback">
                <div *ngIf="
                                            editForm.controls.aisleModeName.errors &&
                                            editForm.controls.aisleModeName.errors.required
                                        ">
                    {{
                                            editForm.controls.aisleModeName.errors.required.message
                                        }}
                </div>
            </div>
        </div>

        <div class="col-md-4 form-group">
            <label>Location</label>
            <select class="form-control" formControlName="directionIndicatorName" [ngClass]="{
                                        'is-invalid': submitted
                                    }">
                <!-- <option value="">Select North/South</option> -->
                <option *ngFor="let direction of directionIndicators" [ngValue]="direction.directionIndicatorCode">
                    {{ direction.directionIndicatorName }}
                </option>
            </select>
            <div *ngIf="submitted" class="invalid-feedback">
                <div *ngIf="
                                            editForm.controls.directionIndicatorName.errors &&
                                            editForm.controls.directionIndicatorName.errors.required">
                    {{
                                            editForm.controls.directionIndicatorName.errors.required.message
                                    }}
                </div>
            </div>
        </div>

        <!-- ------------------------------- Version ---------------------------------- -->
        <div class="col-md-4 form-group">
            <label>Version</label>
            <input type="text" class="form-control" formControlName="version" [ngClass]="{
                                'is-invalid': submitted
                            }" [readonly]="true" />
            <div *ngIf="submitted" class="invalid-feedback">
                <div *ngIf="
                                            editForm.controls.version.errors &&
                                            editForm.controls.version.errors.required">
                    {{
                                        editForm.controls.version.errors.required.message
                                    }}
                </div>
            </div>
        </div>

        <div class="col-md-4 form-group">
            <label>Sensor InAct Time</label>
            <select class="form-control" [ngClass]="{'is-invalid': submitted}" formControlName="sit">
                <!-- <option value="">Select Sensor InAct Time</option> -->
                <option *ngFor="let item of sensorInactTimeList" [ngValue]="item.sit">
                    {{ item.sit }}
                </option>
            </select>
            <div *ngIf="submitted" class="invalid-feedback">
                <div *ngIf="
                                    editForm.controls.sit.errors &&
                                    editForm.controls.sit.errors.required">
                    {{
                                    editForm.controls.sit.errors.required.message
                                }}
                </div>
            </div>
        </div>





        <div class="col-md-4 form-group">
            <label>Que Length</label>
            <select class="form-control" [ngClass]="{'is-invalid': submitted}" formControlName="queLength">
                <!-- <option value="">Select Que Length</option> -->
                <option *ngFor="let item of queLengthList" [ngValue]="item.queLength">
                    {{ item.queLength }}
                </option>
            </select>
            <div *ngIf="submitted" class="invalid-feedback">
                <div *ngIf="
                                        editForm.controls.queLength.errors &&
                                        editForm.controls.queLength.errors.required">
                    {{
                                        editForm.controls.queLength.errors.required.message
                                    }}
                </div>
            </div>
        </div>

        <div class="col-md-4 form-group">
            <label>Flap Safety Time</label>
            <select class="form-control" [ngClass]="{'is-invalid': submitted}" formControlName="flapTime">
                <!-- <option value="">Select Flap Safety Time</option> -->
                <option *ngFor="let item of flapSafetyTimeList" [ngValue]="item.flapTime">
                    {{ item.flapTime }}
                </option>
            </select>
            <div *ngIf="submitted" class="invalid-feedback">
                <div *ngIf="
                                        editForm.controls.flapTime.errors &&
                                        editForm.controls.flapTime.errors.required">
                    {{
                                        editForm.controls.flapTime.errors.required.message
                                    }}
                </div>
            </div>
        </div>
        <div class="col-md-4 form-group">
            <label>Gate Reset Time</label>
            <select class="form-control" [ngClass]="{'is-invalid': submitted}" formControlName="gateResetTime">
                <!-- <option value="">Select Gate Reset Time</option> -->
                <option *ngFor="let item of gateResetTimeList" [ngValue]="item.gateResetTime">
                    {{ item.gateResetTime }}
                </option>
            </select>
            <div *ngIf="submitted" class="invalid-feedback">
                <div *ngIf="
                                        editForm.controls.gateResetTime.errors &&
                                        editForm.controls.gateResetTime.errors.required">
                    {{
                                        editForm.controls.gateResetTime.errors.required.message
                                    }}
                </div>
            </div>
        </div>

        <div class="col-md-4 form-group">
            <label>Buzzer Volume</label>
            <select class="form-control" [ngClass]="{'is-invalid': submitted}" formControlName="buzzerVolume">
                <!-- <option value="">Select Buzzer Volume</option> -->
                <option *ngFor="let item of buzzerVolumeList" [ngValue]="item.buzzerVolume">
                    {{ item.buzzerVolume }}
                </option>
            </select>
            <div *ngIf="submitted" class="invalid-feedback">
                <div *ngIf="
                                        editForm.controls.buzzerVolume.errors &&
                                        editForm.controls.buzzerVolume.errors.required">
                    {{
                                        editForm.controls.buzzerVolume.errors.required.message
                                    }}
                </div>
            </div>
        </div>
        <div class="col-md-4 form-group">
            <label>Light Intensity</label>
            <select class="form-control" [ngClass]="{'is-invalid': submitted}" formControlName="lightIntensity">
                <!-- <option value="">Select Light Intensity</option> -->
                <option *ngFor="let item of lightIntensityList" [ngValue]="item.lightIntensity">
                    {{ item.lightIntensity }}
                </option>
            </select>
            <div *ngIf="submitted" class="invalid-feedback">
                <div *ngIf="
                                        editForm.controls.lightIntensity.errors &&
                                        editForm.controls.lightIntensity.errors.required">
                    {{
                                        editForm.controls.lightIntensity.errors.required.message
                                    }}
                </div>
            </div>
        </div>

        <div class="col-md-4 form-group">
            <label>Action Type</label>
            <select class="form-control" formControlName="actionType" [ngClass]="{
                                    'is-invalid': submitted
                                }">
                <!-- <option value="">Select Action Type</option> -->
                <option *ngFor="let item of actionTypeList" [ngValue]="item.actionType">
                    {{ item.actionType }}
                </option>
            </select>
            <div *ngIf="submitted" class="invalid-feedback">
                <div *ngIf="
                                        editForm.controls.actionType.errors &&
                                        editForm.controls.actionType.errors.required">
                    {{
                                            editForm.controls.actionType.errors.required.message
                                    }}
                </div>
            </div>
        </div>

        <div class="col-md-6 form-group">
            <label>Activation Time</label>
            <timepicker [ngClass]="{'is-invalid': submitted && fval.activationTime.errors}" formControlName="activationTime"></timepicker>
            <div *ngIf="submitted" class="invalid-feedback">
                <div *ngIf="
                                        editForm.controls.activationTime.errors &&
                                        editForm.controls.activationTime.errors.required">
                    {{
                                        editForm.controls.activationTime.errors.required.message
                                    }}
                </div>
            </div>
        </div>

        <div class="col-md-6 form-group">
            <label>Deactivation Time</label>
            <timepicker [ngClass]="{'is-invalid': submitted && fval.deactivationTime.errors}" formControlName="deactivationTime"></timepicker>
            <div *ngIf="submitted && fval.deactivationTime.errors" class="invalid-feedback">
                <div *ngIf="
                                        editForm.controls.deactivationTime.errors &&
                                        editForm.controls.deactivationTime.errors.required">
                    {{
                                        editForm.controls.deactivationTime.errors.required.message
                                    }}
                </div>
            </div>
        </div>

    </div>

    <hr>

    <div formArrayName="terminal">
        <button
            *ngIf="data.terminal.length<2 && terminal().length<2"
            type="button"
            class="btn btn-primary mb-2"
            (click)="addTerminal()"
        >
            Add Terminal
        </button>
    

        <button type="submit" class="btn btn-warning pull-right" [disabled]="editForm.invalid">
            Update&nbsp;<span class="fa fa-send"></span>
        </button>

        <div style="height: 260px;">

            <div class="form-row" *ngFor="let item of terminal().controls; let i = index" [formGroupName]="i">

                <ng-container *ngIf="i < 2">
                    <h4 id="ml-10">Terminal {{ i + 1 }}</h4>
                    <div class="col-md-2 form-group">
                        <label>Terminal Name</label>
                        <select class="form-control" formControlName="terminalName" [ngClass]="{
                                'is-invalid': submitted}">
                            <option *ngFor="let option of options" [value]="option">{{option}}</option>
                        </select>
                        <i class="terminaldescriptn">Update terminal T1, T2.</i>
                    </div>
                    <div class="col-md-2 form-group" *ngIf="i==0 || data.terminal.length==2">
                        <label>Terminal Device ID</label>
                        <input type="text" class="form-control" formControlName="deviceId" [ngClass]="{
                            'is-invalid': submitted}" readonly>
                    </div>
                    <div class="col-md-2 form-group" *ngIf="i>0 && data.terminal.length<2">
                        <label>Terminal Device ID</label>
                        <select
                            class="form-control"
                            formControlName="deviceId"
                            [ngClass]="{'is-invalid': submitted && item.get('deviceId').errors}"
                        >
                        <!-- item.controls.deviceId.errors -->
                            <option value="">Select Device ID</option>
                            <option *ngFor="let item of terminalList">
                                {{ item.deviceId }}
                            </option>
                        </select>
                        <div *ngIf="submitted && item.get('deviceId').errors" class="invalid-feedback">
                            <div *ngIf="item.get('deviceId').errors['required']">
                                {{ item.get('deviceId')!.errors['required'].message }}
                            </div>
                        </div>
                        <i class="terminaldescriptn">Select device id.</i>
                    </div>
                    <div class="col-md-2 form-group">
                        <label>Terminal IP</label>
                        <input type="text" class="form-control" formControlName="terminalIp" [ngClass]="{
                                        'is-invalid': submitted}" required
                            pattern="^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$" />
                        <div *ngIf="submitted  && fval.terminalIp.errors" class="invalid-feedback">
                            <div *ngIf="
                                editForm.controls.terminalIp.errors &&
                                editForm.controls.terminalIp.errors.required">
                                <!-- editForm.controls.terminal.terminalIp.errors.required.message -->
                                {{
                                editForm.controls.terminalIp.errors.required.message
                            }}
                            </div>
                        </div>
                        <i class="terminaldescriptn">IPv4- 0.0.0.0 - 255.255.255.255</i>
                    </div>
                    <!-- &nbsp;&nbsp; -->
                    <div class="col-md-2 form-group">
                        <label>Terminal Mode</label>
                        <select class="form-control" formControlName="modeType" [ngClass]="{
                                'is-invalid': submitted  && fval.modeType.errors
                            }">
                            <!-- <option value="">Select Mode</option> -->
                            <option *ngFor="let item of terminalModeList" [ngValue]="item.modeType">
                                {{ item.modeType }}
                            </option>
                        </select>
                        <div *ngIf="submitted" class="invalid-feedback">
                            <div *ngIf="
                            editForm.controls.modeType.errors &&
                            editForm.controls.modeType.errors.required">
                                {{
                                    editForm.controls.modeType.errors.required.message
                                    }}
                            </div>
                        </div>
                    </div>

                    <div class="form-group" *ngIf="i!=0 && data.terminal.length!=2">
                        <button class="btn btn-danger btn-set" (click)="removeTerminal(i)">
                            Remove
                        </button>
                    </div>
                </ng-container>

            </div>
        </div>
    </div>
</form>